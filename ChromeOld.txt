#!/bin/bash

# ==========================
# Script cÃ i Chrome tá»« Google Drive folder ID (Ä‘Æ°á»£c cung cáº¥p trá»±c tiáº¿p)
# ==========================

# Nháº­p ID folder Google Drive
DRIVE_ID="$1tD0XPj-t5C7p9ByV3RLg-qcHaYYSXAj1"

if [[ -z "$DRIVE_ID" ]]; then
    echo "âŒ Báº¡n chÆ°a cung cáº¥p ID cá»§a folder Google Drive!"
    echo "VÃ­ dá»¥: ./install_chrome_from_drive.sh YOUR_FOLDER_ID"
    exit 1
fi

# ThÆ° má»¥c táº¡m chá»©a file táº£i vá»
DOWNLOAD_DIR="$HOME/chrome_temp"
mkdir -p "$DOWNLOAD_DIR"
cd "$DOWNLOAD_DIR" || exit

# Liá»‡t kÃª file tá»« folder
echo "ğŸ“‚ Äang láº¥y danh sÃ¡ch file tá»« Google Drive..."
gdown --folder "https://drive.google.com/drive/folders/$DRIVE_ID" --no-cookies

echo "ğŸ” CÃ¡c file Chrome táº£i vá»:"
ls google-chrome-stable_*.deb

# Chá»n file Ä‘á»ƒ cÃ i
read -p "ğŸ‘‰ Nháº­p Ä‘Ãºng tÃªn file .deb cáº§n cÃ i: " CHROME_FILE

if [[ ! -f "$CHROME_FILE" ]]; then
    echo "âŒ KhÃ´ng tÃ¬m tháº¥y file: $CHROME_FILE"
    exit 1
fi

# Gá»¡ Chrome cÅ© náº¿u cÃ³
echo "ğŸ—‘ï¸ Gá»¡ báº£n Chrome cÅ© (náº¿u cÃ³)..."
sudo apt remove -y google-chrome-stable

# CÃ i file Ä‘Ã£ chá»n
echo "ğŸš€ CÃ i Ä‘áº·t Chrome: $CHROME_FILE"
sudo dpkg -i "$CHROME_FILE"
sudo apt -f install -y

# KhÃ³a cáº­p nháº­t
echo "ğŸ”’ KhÃ³a phiÃªn báº£n Chrome..."
sudo apt-mark hold google-chrome-stable

# VÃ´ hiá»‡u hÃ³a repo Google
REPO_FILE="/etc/apt/sources.list.d/google-chrome.list"
if [[ -f "$REPO_FILE" ]]; then
    sudo sed -i 's/^deb/# deb/' "$REPO_FILE"
fi

# Táº¡o shortcut trong menu
cat <<EOF > ~/.local/share/applications/google-chrome.desktop
[Desktop Entry]
Version=1.0
Name=Google Chrome (Custom)
Exec=/usr/bin/google-chrome-stable %U
Terminal=false
Icon=google-chrome
Type=Application
Categories=Network;WebBrowser;
StartupNotify=true
EOF

# Pin vÃ o taskbar (GNOME hoáº·c Lubuntu panel)
gio set ~/.local/share/applications/google-chrome.desktop metadata::trusted true
if command -v gsettings &> /dev/null; then
    gsettings set org.gnome.shell favorite-apps "$(gsettings get org.gnome.shell favorite-apps | sed "s/]$/, 'google-chrome.desktop']/")"
fi

echo "âœ… HoÃ n táº¥t! Chrome Ä‘Ã£ Ä‘Æ°á»£c táº£i tá»« Drive, cÃ i Ä‘áº·t, khÃ³a update vÃ  pin vÃ o taskbar."
